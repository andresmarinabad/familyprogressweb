<!doctype html>
<html class="dark">
<head>
  <meta charset="UTF-8">
  <title> Family Expansion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>

  <style>
    .header {
        text-align: center;
        position: relative;
        padding: 20px 0;
    }

    .progress-pink {
        background-color: lightpink !important;
    }

    .progress-orange {
        background-color: rgba(255, 154, 0, 1) !important;
    }

    .progress-yellow {
        background-color: rgba(208, 222, 33, 1) !important;
    }

    .progress-green {
        background-color: rgba(79, 220, 74, 1) !important;
    }

    .progress-aquamarine {
        background-color: rgba(63, 218, 216, 1) !important;
    }

    .progress-cyan {
        background-color: rgba(47, 201, 226, 1) !important;
    }

    .progress-river {
        background-color: rgba(28, 127, 238, 1) !important;
    }

    .progress-blue {
        background-color:rgba(95, 21, 242, 1) !important;
    }

    .progress-purple {
        background-color: rgb(100, 5, 134) !important;
    }

</style>

</head>
<body onload="brython()">

<h1 class="text-5xl font-extrabold dark:text-white" style="text-align: center;">Family Expansion</h1>

<section class="bg-white dark:bg-gray-900">
    <div class="container px-6 py-10 mx-auto" id="contenedor">


        <!-- KID -->


        <div hidden class="grid grid-cols-1 gap-8 mt-8 xl:mt-16 md:grid-cols-2 xl:grid-cols-3" id="kid">

            <div class="flex flex-col items-center">
                <img class="object-cover w-full rounded-xl aspect-square card-img-top" src="" alt="">

                <h1 class="mt-4 text-2xl font-semibold text-gray-700 capitalize dark:text-white card-title">Nombre</h1>

                <p class="mt-2 text-gray-500 capitalize dark:text-gray-300 card-subtitle">Cumple</p>

                <span hidden class="hidden-number"></span>

                <div class="flex mt-3 -mx-2">
                    
                    <div class="progress" style="margin: 5px;">
                        <div class="auxbar" role="progressbar" style="width: 10%"></div>
                    </div>
                    
                </div>
            </div>
        </div>



    </div>
</section>

<script type="text/python">
    
    import browser
    import json
    from browser import document
    from datetime import date, datetime


    def get_hidden_number(item):
      return int(item.select_one(".hidden-number").text)

    
    class Kid:
        def __init__(self, nombre, fecha, embarazo=False):
            self.nombre = nombre
            self.fecha = fecha
            self.foto = f'images/{nombre.lower()}.jpeg'
            self.embarazo = embarazo
            self.edad, self.cumple_date, self.progreso = self.progress()
        
        def __str__(self):
            if self.embarazo:
                return f"Fecha de parto {self.fecha}"
            return f"Cumple {str(self.edad)}  el {self.cumple_date.strftime('%d/%m/%Y')}"
        
        def progress(self):
            today = datetime.today()

            if self.embarazo:
                fecha_parto = datetime.strptime(self.fecha, '%d/%m/%Y')
                dif_dates = (fecha_parto - today).days
                return 0, fecha_parto, int(((270 - dif_dates)/270) * 100)

            current_year = date.today().year
            parts = self.fecha.split('/')
            cumple = f'{parts[0]}/{parts[1]}/{current_year}'
    
            cumple_date = datetime.strptime(cumple, '%d/%m/%Y')
    
            edad = current_year - int(parts[2])
    
            if today >= cumple_date:
                edad += 1
                self.fecha = f'{parts[0]}/{parts[1]}/{current_year+1}'
                cumple_date = datetime.strptime(self.fecha, '%d/%m/%Y')
            else:
                self.fecha = f'{parts[0]}/{parts[1]}/{current_year}'
            
            dif_dates = (cumple_date - today).days
            return edad, cumple_date, int(((365 - dif_dates)/365) * 100)


    kids = []
    
    div_kid = document["kid"]
    div_kid.removeAttribute("hidden")
    contenedor = document["contenedor"]
    contenedor.clear()

    data_file = "static/json/data.json"
    data = json.load(open(data_file))

    for objeto in data:
        try:
            kids.append(Kid(objeto['nombre'], objeto['fecha'], objeto['embarazo']))
        except KeyError:
            kids.append(Kid(objeto['nombre'], objeto['fecha']))

    kids.sort(key=lambda x: x.progreso, reverse=True)


    for kid in kids:
        new_div_kid = div_kid.cloneNode(True)
        
        foto_link = new_div_kid.querySelector(".card-img-top")
        foto_link.src = kid.foto

        name_header = new_div_kid.querySelector(".card-title")
        name_header.text = kid.nombre

        cumple_header = new_div_kid.querySelector(".card-subtitle")
        cumple_header.text = f"{kid}"

        progress_div = new_div_kid.querySelector(".auxbar")
        progress_div.style.width = f"{str(kid.progreso)}%"

        hidden_span = new_div_kid.querySelector(".hidden-number")
        hidden_span.text = kid.progreso

        
        if kid.progreso < 10:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-pink'
        elif kid.progreso < 20:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated bg-danger'
        elif kid.progreso < 30:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-orange'
        elif kid.progreso < 40:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-yellow'
        elif kid.progreso < 50:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-green'
        elif kid.progreso < 60:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-aquamarine'
        elif kid.progreso < 70:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-cyan'
        elif kid.progreso < 80:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-river'
        elif kid.progreso < 90:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-blue'
        else:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-purple'
        
        contenedor.appendChild(new_div_kid)


       
</script>

</body>
</html>