<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Expansion</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>

  <style>
    .header {
        text-align: center;
        position: relative;
        padding: 20px 0;
    }

    .progress-rojo-intenso {
        background-color: rgb(255, 0, 0) !important;
    }
    .progress-rojo-anaranjado {
        background-color: rgb(255, 64, 0) !important;
    }
    .progress-naranja-oscuro {
        background-color: rgb(255, 128, 0) !important;
    }
    .progress-naranja-claro {
        background-color: rgb(255, 191, 0) !important;
    }
    .progress-amarillo-dorado {
        background-color: rgb(255, 255, 0) !important;
    }
    .progress-amarillo-verdoso {
        background-color: rgb(191, 255, 0) !important;
    }
    .progress-verde-claro {
        background-color: rgb(128, 255, 0) !important;
    }
    .progress-verde-lima {
        background-color: rgb(64, 255, 0) !important;
    }
    .progress-verde-intenso {
        background-color: rgb(0, 255, 0) !important;
    }
    .progress-verde-azulado {
        background-color: rgb(0, 255, 64) !important;
    }
    .progress-turquesa {
        background-color: rgb(0, 255, 128) !important;
    }
    .progress-cian {
        background-color: rgb(0, 255, 191) !important;
    }
    .progress-azul-claro {
        background-color: rgb(0, 255, 255) !important;
    }
    .progress-azul-cielo {
        background-color: rgb(0, 191, 255) !important;
    }
    .progress-azul-medio {
        background-color: rgb(0, 128, 255) !important;
    }
    .progress-azul-intenso {
        background-color: rgb(0, 64, 255) !important;
    }
    .progress-azul-oscuro {
        background-color: rgb(0, 0, 255) !important;
    }
    .progress-indigo {
        background-color: rgb(64, 0, 255) !important;
    }
    .progress-violeta {
        background-color: rgb(128, 0, 255) !important;
    }
    .progress-purpura {
        background-color: rgb(191, 0, 255) !important;
    }


    @keyframes stripesAnimation {
      0% { background-position: 100% 0; }
      100% { background-position: 0 0; }
    }

    .striped-progress-bar {
      background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
      background-size: 20px 20px;
      animation: stripesAnimation 10s linear infinite;
    }


</style>

</head>
<body class="bg-gray-100" onload="brython()">

  <section class="container mx-auto p-6">
    <h2 class="text-4xl font-bold text-center mb-8">Family Expansion</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="contenedor">
      
      <!-- Team Member 1 -->
      <div hidden class="bg-white p-6 rounded-lg shadow-md" id="kid">

        <img class="object-cover w-full rounded-xl aspect-square card-img-top mx-auto mb-4" src="" alt="">

        <h3 class="text-xl font-semibold text-center card-title">Nombre</h3>
        <p class="text-gray-600 text-center card-subtitle">Cumple</p>
        <span hidden class="hidden-number"></span>
        <div class="text-center mt-4">
          
            <div class="w-full max-w-xl bg-gray-200 rounded-full h-5 overflow-hidden">
                <div class="auxbar"></div>
            </div>

        </div>
      </div>

    </div>
  </section>

  <script type="text/python">
    
    import browser
    import json
    from browser import document
    from datetime import date, datetime


    def get_hidden_number(item):
      return int(item.select_one(".hidden-number").text)

    
    class Kid:
        def __init__(self, nombre, fecha, embarazo=False):
            self.nombre = nombre
            self.fecha = fecha
            self.foto = f'images/{nombre.lower()}.jpeg'
            self.embarazo = embarazo
            self.edad, self.cumple_date, self.progreso = self.progress()
        
        def __str__(self):
            if self.embarazo:
                return f"Fecha de parto {self.fecha}"
            return f"Cumple {str(self.edad)}  el {self.cumple_date.strftime('%d/%m/%Y')}"
        
        def progress(self):
            today = datetime.today()

            if self.embarazo:
                fecha_parto = datetime.strptime(self.fecha, '%d/%m/%Y')
                dif_dates = (fecha_parto - today).days
                return 0, fecha_parto, int(((270 - dif_dates)/270) * 100)

            current_year = date.today().year
            parts = self.fecha.split('/')
            cumple = f'{parts[0]}/{parts[1]}/{current_year}'
    
            cumple_date = datetime.strptime(cumple, '%d/%m/%Y')
    
            edad = current_year - int(parts[2])
    
            if today >= cumple_date:
                edad += 1
                self.fecha = f'{parts[0]}/{parts[1]}/{current_year+1}'
                cumple_date = datetime.strptime(self.fecha, '%d/%m/%Y')
            else:
                self.fecha = f'{parts[0]}/{parts[1]}/{current_year}'
            
            dif_dates = (cumple_date - today).days
            return edad, cumple_date, int(((365 - dif_dates)/365) * 100)


    kids = []
    
    div_kid = document["kid"]
    div_kid.removeAttribute("hidden")
    contenedor = document["contenedor"]
    contenedor.clear()

    data_file = "static/json/data.json"
    data = json.load(open(data_file))

    for objeto in data:
        try:
            kids.append(Kid(objeto['nombre'], objeto['fecha'], objeto['embarazo']))
        except KeyError:
            kids.append(Kid(objeto['nombre'], objeto['fecha']))

    kids.sort(key=lambda x: x.progreso, reverse=True)


    for kid in kids:
        new_div_kid = div_kid.cloneNode(True)
        
        foto_link = new_div_kid.querySelector(".card-img-top")
        foto_link.src = kid.foto

        name_header = new_div_kid.querySelector(".card-title")
        name_header.text = kid.nombre

        cumple_header = new_div_kid.querySelector(".card-subtitle")
        cumple_header.text = f"{kid}"

        progress_div = new_div_kid.querySelector(".auxbar")
        progress_div.style.width = f"{str(kid.progreso)}%"

        hidden_span = new_div_kid.querySelector(".hidden-number")
        hidden_span.text = kid.progreso

        
        if kid.progreso < 5:
            progress_div.class_name = 'progress-rojo-intenso h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 10:
            progress_div.class_name = 'progress-rojo-anaranjado h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 15:
            progress_div.class_name = 'progress-naranja-oscuro h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 20:
            progress_div.class_name = 'progress-naranja-claro h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 25:
            progress_div.class_name = 'progress-amarillo-dorado h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 30:
            progress_div.class_name = 'progress-amarillo-verdoso h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 35:
            progress_div.class_name = 'progress-verde-claro h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 40:
            progress_div.class_name = 'progress-verde-lima h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 45:
            progress_div.class_name = 'progress-verde-intenso h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 50:
            progress_div.class_name = 'progress-verde-azulado h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 55:
            progress_div.class_name = 'progress-turquesa h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 60:
            progress_div.class_name = 'progress-cian h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 65:
            progress_div.class_name = 'progress-azul-claro h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 70:
            progress_div.class_name = 'progress-azul-cielo h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 75:
            progress_div.class_name = 'progress-azul-medio h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 80:
            progress_div.class_name = 'progress-azul-intenso h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 85:
            progress_div.class_name = 'progress-azul-oscuro h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 90:
            progress_div.class_name = 'progress-indigo h-5 rounded-full striped-progress-bar'
        elif kid.progreso < 95:
            progress_div.class_name = 'progress-violeta h-5 rounded-full striped-progress-bar'
        else:
            progress_div.class_name = 'progress-purpura h-5 rounded-full striped-progress-bar'
        
        contenedor.appendChild(new_div_kid)

    class Carousel:
        def __init__(self, container_id, interval=3000):
            self.container = document[container_id]
            self.items = self.container.select('.carousel-item')
            self.total_items = len(self.items)
            self.current_index = 0
            self.interval = interval
            self.start()

        def start(self):
            self.timer = timer.set_interval(self.next, self.interval)

        def next(self, *args):
            self.items[self.current_index].classList.add('hidden')
            self.current_index = (self.current_index + 1) % self.total_items
            self.items[self.current_index].classList.remove('hidden')
    
    def add_carousel_image(container, img_src):
        item = html.DIV(Class='carousel-item hidden')
        item <= html.IMG(src=img_src, Class='w-full h-auto')
        container <= item
    
    team_carousels = {
        "carousel-inner-1": ["images/marta.jpeg", "images/mateo.jpeg", "images/catalina.jpeg"]
    }

    for carousel_id, images in team_carousels.items():
        container = document[carousel_id]
        for img_src in images:
            add_carousel_image(container, img_src)
            carousel = Carousel(carousel_id)
            carousel.items[0].classList.remove('hidden')


       
</script>


</body>
</html>
