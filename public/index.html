<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> Family Progress Web</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <style>
        .header {
            text-align: center;
            position: relative;
            padding: 20px 0;
        }

        .progress-pink {
            background-color: lightpink !important;
        }

        .progress-orange {
            background-color: rgba(255, 154, 0, 1) !important;
        }

        .progress-yellow {
            background-color: rgba(208, 222, 33, 1) !important;
        }

        .progress-green {
            background-color: rgba(79, 220, 74, 1) !important;
        }

        .progress-aquamarine {
            background-color: rgba(63, 218, 216, 1) !important;
        }

        .progress-cyan {
            background-color: rgba(47, 201, 226, 1) !important;
        }

        .progress-river {
            background-color: rgba(28, 127, 238, 1) !important;
        }

        .progress-blue {
            background-color:rgba(95, 21, 242, 1) !important;
        }

        .progress-purple {
            background-color: rgb(100, 5, 134) !important;
        }

    </style>

</head>

<script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js">
</script>
<script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js">
</script>

<body onload="brython()">

    <div class="page-header" style="background-color: rgb(12, 165, 185);height: 100px; color: white; padding-top: 25px; padding-left: 25px;">
        <h1>Family Progress <small>Kids</small></h1>
    </div>


<div class="py-5">
  
    <div class="container">
      <div class="row hidden-md-up" id="contenedor">

        <!-- KID -->

          <div hidden class="col-md-4" id="kid">
          <div class="card" style="margin-bottom: 20px;">
            <div class="card-block">
                <img class="card-img-top" src="" alt="Foto perfil">
                <h4 class="card-title" style="padding: 5px;">Nombre</h4>
                <h6 class="card-subtitle text-muted" style="padding: 5px;">Cumple</h6>
                <span hidden class="hidden-number"></span>
                <div class="progress" style="margin: 5px;">
                    <div class="auxbar" role="progressbar" style="width: 10%"></div>
                </div>
            </div>
          </div>
          </div>

      </div>
    </div>

      
      

</div>

<script type="text/python">
    
    import browser
    import json
    from browser import document
    from datetime import date, datetime


    def get_hidden_number(item):
      return int(item.select_one(".hidden-number").text)

    
    class Kid:
        def __init__(self, nombre, fecha, embarazo=False):
            self.nombre = nombre
            self.fecha = fecha
            self.foto = f'images/{nombre.lower()}.jpeg'
            self.embarazo = embarazo
            self.edad, self.cumple_date, self.progreso = self.progress()
        
        def __str__(self):
            if self.embarazo:
                return f"Fecha de parto {self.fecha}"
            return f"Cumple {str(self.edad)}  el {self.cumple_date.strftime('%d/%m/%Y')}"
        
        def progress(self):
            today = datetime.today()

            if self.embarazo:
                fecha_parto = datetime.strptime(self.fecha, '%d/%m/%Y')
                dif_dates = (fecha_parto - today).days
                return 0, fecha_parto, int(((270 - dif_dates)/270) * 100)

            current_year = date.today().year
            parts = self.fecha.split('/')
            cumple = f'{parts[0]}/{parts[1]}/{current_year}'
    
            cumple_date = datetime.strptime(cumple, '%d/%m/%Y')
    
            edad = current_year - int(parts[2])
    
            if today >= cumple_date:
                edad += 1
                self.fecha = f'{parts[0]}/{parts[1]}/{current_year+1}'
                cumple_date = datetime.strptime(self.fecha, '%d/%m/%Y')
            else:
                self.fecha = f'{parts[0]}/{parts[1]}/{current_year}'
            
            dif_dates = (cumple_date - today).days
            return edad, cumple_date, int(((365 - dif_dates)/365) * 100)


    kids = []
    
    div_kid = document["kid"]
    div_kid.removeAttribute("hidden")
    contenedor = document["contenedor"]
    contenedor.clear()

    data_file = "static/json/data.json"
    data = json.load(open(data_file))

    for objeto in data:
        try:
            kids.append(Kid(objeto['nombre'], objeto['fecha'], objeto['embarazo']))
        except KeyError:
            kids.append(Kid(objeto['nombre'], objeto['fecha']))

    kids.sort(key=lambda x: x.progreso, reverse=True)


    for kid in kids:
        new_div_kid = div_kid.cloneNode(True)
        
        foto_link = new_div_kid.querySelector(".card-img-top")
        foto_link.src = kid.foto

        name_header = new_div_kid.querySelector(".card-title")
        name_header.text = kid.nombre

        cumple_header = new_div_kid.querySelector(".card-subtitle")
        cumple_header.text = f"{kid}"

        progress_div = new_div_kid.querySelector(".auxbar")
        progress_div.style.width = f"{str(kid.progreso)}%"

        hidden_span = new_div_kid.querySelector(".hidden-number")
        hidden_span.text = kid.progreso

        
        if kid.progreso < 10:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-pink'
        elif kid.progreso < 20:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated bg-danger'
        elif kid.progreso < 30:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-orange'
        elif kid.progreso < 40:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-yellow'
        elif kid.progreso < 50:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-green'
        elif kid.progreso < 60:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-aquamarine'
        elif kid.progreso < 70:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-cyan'
        elif kid.progreso < 80:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-river'
        elif kid.progreso < 90:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-blue'
        else:
            progress_div.class_name = 'progress-bar progress-bar-striped progress-bar-animated progress-purple'
        
        contenedor.appendChild(new_div_kid)


       
</script>


<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://pingendo.com/assets/bootstrap/bootstrap-4.0.0-alpha.6.min.js"></script>

</body>
</html>
